"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{70913:function(e,n,i){i.d(n,{Bo:function(){return _},KN:function(){return g},MH:function(){return A},Nt:function(){return w},QO:function(){return E},QU:function(){return m},Ux:function(){return f},Xg:function(){return b},Y:function(){return T},bN:function(){return p},is:function(){return Q},kK:function(){return h},kS:function(){return M},oy:function(){return U},pV:function(){return C},vF:function(){return S}});var t=i(83041),u=i(16096),a=i(33062),r=i(78725),o=i(28648),s=i(35146),l=i(88337),c=i(84983),d=i(7653),v=i(83894);function f(e){let{onError:n}=e,{activeOrganization:i}=(0,u.useCurrentAccount)(),{data:a,variables:r,...o}=(0,t.uC)("/api/billing/".concat(null==i?void 0:i.uuid,"/consumer_pricing"),"POST",{enabled:!!i,meta:{noToast:!0},onError:n}),[s,l]=(0,d.useState)(),[c,v]=(0,d.useState)();return(0,d.useEffect)(()=>{a&&(l(a),v(r))},[a,r]),{data:s,variables:c,...o}}function m(e){let{onError:n}=e,{activeOrganization:i}=(0,u.useCurrentAccount)(),{data:a,variables:r,...o}=(0,t.uC)("/api/billing/".concat(null==i?void 0:i.uuid,"/cw_pricing"),"POST",{enabled:!!i,meta:{noToast:!0},onError:n}),[s,l]=(0,d.useState)(),[c,v]=(0,d.useState)();return(0,d.useEffect)(()=>{a&&(l(a),v(r))},[a,r]),{data:s,variables:c,...o}}let g=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)();return(0,t.uC)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription"),"PUT",{enabled:!!e})},p=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)();return(0,t.uC)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription/cw"),"PUT",{enabled:!!e})};function b(){let{activeOrganization:e}=(0,u.useCurrentAccount)();return(0,t.WE)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription_details"),{queryKey:[s.QU,null==e?void 0:e.uuid],staleTime:0,enabled:!!e,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})}function y(){let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=(0,u.useHasRaven)();return(0,t.WE)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription_status"),{queryKey:[s.sM,null==e?void 0:e.uuid],staleTime:0,enabled:!!e&&n,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})}function C(){let{data:e,isLoading:n}=y();return{isRavenCanceled:(null==e?void 0:e.status)==="canceled"||(null==e?void 0:e.status)==="unpaid",isLoading:n}}function Q(){let{data:e,isLoading:n}=y();return{isRavenPastDue:(null==e?void 0:e.status)==="past_due",isLoading:n}}function T(){let{data:e,isLoading:n}=y();return{isRavenPendingCancellation:!!(null==e?void 0:e.cancel_at_ts),isLoading:n}}function h(){let{isRavenCanceled:e,isLoading:n}=C(),{isRavenPastDue:i,isLoading:t}=Q(),{isRavenPendingCancellation:u,isLoading:a}=T(),{minimumApplied:r,isLoading:o}=E(),s=n||t||a||o;return{isLoading:s,canManageMembers:!s&&!e&&!i&&(!u||r)}}function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,c.useQueryClient)(),a=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(a,"/end_subscription"),"PUT",{...e,onSuccess(n,t,u){var r;i.setQueryData([s.QU,a],e=>{if(e)return{...e,plan_ending_before:"".concat(n.plan_ends_at,"T00:00:00+00:00")}}),i.invalidateQueries([s.sM,a]),i.invalidateQueries([s.je,a]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,u)},enabled:!!n})}function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,c.useQueryClient)(),a=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(a,"/resume_subscription"),"PUT",{...e,onSuccess(n,t,u){var r;i.setQueryData([s.QU,a],e=>{if(e)return{...e,plan_ending_before:null}}),i.invalidateQueries([s.sM,a]),i.invalidateQueries([s.je,a]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,u)},enabled:!!n})}function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,c.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(null==n?void 0:n.uuid,"/renew_subscription/cw"),"PUT",{...e,onSuccess(t,u,a){var r;i.invalidateQueries([s.QU,null==n?void 0:n.uuid]),i.invalidateQueries([s.sM,null==n?void 0:n.uuid]),i.invalidateQueries([s.RK,null==n?void 0:n.uuid]),i.invalidateQueries([s.je,null==n?void 0:n.uuid]),null===(r=e.onSuccess)||void 0===r||r.call(e,t,u,a)},enabled:!!n})}function A(e){let{limit:n,createdSince:i,organizationUUID:a,meta:r}=e,{activeOrganization:o}=(0,u.useCurrentAccount)(),l=Math.round(i.toSeconds()),c=a||(null==o?void 0:o.uuid);return(0,t.WE)("/api/stripe/".concat(c,"/invoices?limit=").concat(n,"&created_since_ts=").concat(l),{queryKey:[s.RK,c,{limit:n,created_since_ts:l}],staleTime:0,enabled:!!c,meta:r})}function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,u.useHasRaven)();return(0,t.WE)("/api/stripe/".concat(null==n?void 0:n.uuid,"/upcoming_invoice"),{queryKey:[s.je,null==n?void 0:n.uuid],staleTime:0,enabled:!!n&&i,meta:{noToast:e=>e instanceof o.Hx&&500===e.statusCode},...e})}function M(){let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=(0,c.useQueryClient)(),i=null==e?void 0:e.uuid;return(0,t.uC)("/api/organizations/".concat(i,"/payment_method/update_latest"),"POST",{onSuccess:async e=>{let t=n.getQueryData([s.QU,i]);t&&e?n.setQueryData([s.QU,i],{...t,payment_method:{...e}}):await n.invalidateQueries([s.QU,i]),n.invalidateQueries([s.sM,i]),n.invalidateQueries([s.RK,i])},meta:{noToast:!0}})}function E(){let{data:e,isLoading:n}=(0,r.uy)(),{data:i,isLoading:t}=(0,r.cK)(),o=(0,a.N)(l.YB.MembersManage),{data:s}=(0,v.aJ)(),c=(0,u.useIsEnterprise)(),d=n||t||!e||!i||!s;if(d)return{isLoading:d,hasManageMembersPermission:o,membersWithMinApplied:!1,activeMembers:0,invitedMembers:0,unclaimedMembers:0,minimumApplied:!1,memberLimit:0};let f=e.length,m=i.filter(e=>"pending"===e.status).length,g=f+m,p=c?s.members_limit-g:Math.max(5-g,0);return{isLoading:d,hasManageMembersPermission:o,totalMembersWithoutMinimumApplied:g,totalMembersWithMinimumApplied:Math.max(f+m,5),activeMembers:f,invitedMembers:m,unclaimedMembers:p,minimumApplied:g<5,memberLimit:s.members_limit}}},83894:function(e,n,i){i.d(n,{$f:function(){return c},$r:function(){return o},CQ:function(){return s},aJ:function(){return l}});var t=i(83041),u=i(16096),a=i(35146),r=i(84983);let o=e=>(0,t.WE)("/api/organizations/".concat(e),{queryKey:[a.mm,e],enabled:!!e,staleTime:3e4}),s=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=null==e?void 0:e.uuid;return(0,t.Ne)(e=>{let{flagType:i}=e;return"/api/organizations/".concat(n,"/flags/").concat(i,"/dismiss")},"POST",(e,n)=>{let{flagType:i}=e;if(n)return{...n,active_flags:n.active_flags.filter(e=>e.type!==i)}},{queryKey:[a.mm,n]})},l=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=null==e?void 0:e.uuid;return(0,t.WE)("/api/organizations/".concat(n,"/members_limit"),{queryKey:[a.UD,n],enabled:!!n,staleTime:0})};function c(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:i}=(0,u.useCurrentAccount)(),o="/api/organizations/".concat(null!==(e=null==i?void 0:i.uuid)&&void 0!==e?e:""),s=(0,r.useQueryClient)();return(0,t.uC)(o,"PUT",{enabled:!!i,...n,async onSuccess(){for(var e,i=arguments.length,t=Array(i),u=0;u<i;u++)t[u]=arguments[u];await Promise.all([s.invalidateQueries([a.aY]),s.invalidateQueries([a.mm])]),await (null===(e=n.onSuccess)||void 0===e?void 0:e.call(n,...t))}})}},59374:function(e,n,i){i.r(n),i.d(n,{ErrorsProvider:function(){return r},useToasts:function(){return o}});var t=i(27573),u=i(7653);let a=(0,u.createContext)(void 0);function r(e){let{children:n}=e,i=(0,u.useRef)(1),[r,o]=(0,u.useState)([]),s=(0,u.useCallback)(e=>{let n=i.current++;return o(i=>[...i,{id:n,message:e instanceof Error?e.message:e,toastType:"error"}]),n},[]),l=(0,u.useCallback)(e=>{let n=i.current++;return o(i=>[...i,{id:n,message:e,toastType:"success"}]),n},[]),c=(0,u.useCallback)(e=>{o(n=>n.filter(n=>n.id!==e))},[]),d=(0,u.useMemo)(()=>({toasts:r,addError:s,addSuccess:l,clearToast:c}),[r,s,l,c]);return(0,t.jsx)(a.Provider,{value:d,children:n})}function o(){let e=(0,u.useContext)(a);if(!e)throw Error("Must be called within ErrorsProvider");return e}},33062:function(e,n,i){i.d(n,{N:function(){return r}});var t=i(88337),u=i(7653),a=i(16096);function r(e){let{account:n,activeOrganization:i}=(0,a.useCurrentAccount)();return(0,u.useMemo)(()=>(0,t.Di)(n,i,e),[n,i,e])}},78725:function(e,n,i){i.d(n,{DT:function(){return f},Iw:function(){return m},Qx:function(){return g},cK:function(){return d},er:function(){return v},gK:function(){return c},uy:function(){return l},wA:function(){return p}});var t=i(83041),u=i(16096),a=i(59374),r=i(28648),o=i(35146),s=i(84983);let l=()=>{var e;let{activeOrganization:n}=(0,u.useCurrentAccount)();return(0,t.WE)("/api/organizations/".concat(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"","/members"),{enabled:!!(null==n?void 0:n.uuid)&&(n.capabilities.includes("api")||n.capabilities.includes("raven")),queryKey:[o.I_,{orgUUID:null==n?void 0:n.uuid}],staleTime:0})},c=function(e){var n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,u.useCurrentAccount)(),r=(0,s.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(null!==(n=null==a?void 0:a.uuid)&&void 0!==n?n:"","/members/").concat(e),"PUT",{...i,meta:{errorMessage:"There was an error updating the userâ€™s role."},async onSuccess(){for(var e,n=arguments.length,t=Array(n),u=0;u<n;u++)t[u]=arguments[u];await Promise.all([r.invalidateQueries([o.I_,{orgUUID:null==a?void 0:a.uuid}]),r.invalidateQueries([o.BB,{orgUUID:null==a?void 0:a.uuid}])]),await (null===(e=i.onSuccess)||void 0===e?void 0:e.call(i,...t))}})},d=()=>{var e;let{activeOrganization:n}=(0,u.useCurrentAccount)();return(0,t.WE)("/api/organizations/".concat(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"","/invites"),{enabled:!!(null==n?void 0:n.uuid)&&(n.capabilities.includes("api")||n.capabilities.includes("raven")),queryKey:[o.BB,{orgUUID:null==n?void 0:n.uuid}],staleTime:0})},v=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=(0,s.useQueryClient)(),{addError:l}=(0,a.useToasts)(),c="uuid"in n?n.uuid:n.account.uuid,d="email_address"in n?n.email_address:n.account.email_address;return(0,t.uC)("/api/organizations/".concat(e,"/members/").concat(c),"DELETE",{...i,meta:{noToast:!0},async onSuccess(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];await u.invalidateQueries([o.I_,{orgUUID:e}]),u.invalidateQueries([o.je,e]),u.invalidateQueries([o.sM,e]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...a))},onError(e){var n,i;e instanceof r.Hx&&(null===(i=e.extra)||void 0===i?void 0:null===(n=i.details)||void 0===n?void 0:n.type)==="seat_minimum_reached"?l("You cannot go below 5 members."):l("There was an error removing ".concat(d," from the organization."))}})},f=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=(0,s.useQueryClient)(),{addError:l}=(0,a.useToasts)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/").concat(n),"DELETE",{...i,meta:{noToast:!0},async onSuccess(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];await u.invalidateQueries([o.BB,{orgUUID:e}]),u.invalidateQueries([o.je,e]),u.invalidateQueries([o.sM,e]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...a))},onError(e){var n,i;e instanceof r.Hx&&(null===(i=e.extra)||void 0===i?void 0:null===(n=i.details)||void 0===n?void 0:n.type)==="seat_minimum_reached"?l("You cannot go below 5 members."):l("There was an error revoking the invite.")}})},m=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,s.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites"),"POST",{...n,async onSuccess(){for(var t,u=arguments.length,a=Array(u),r=0;r<u;r++)a[r]=arguments[r];await i.invalidateQueries([o.BB,{orgUUID:e}]),i.invalidateQueries([o.je,e]),i.invalidateQueries([o.sM,e]),await (null===(t=n.onSuccess)||void 0===t?void 0:t.call(n,...a))}})},g=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,s.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/bulk"),"POST",{...n,async onSuccess(){for(var t,u=arguments.length,a=Array(u),r=0;r<u;r++)a[r]=arguments[r];await i.invalidateQueries([o.BB,{orgUUID:e}]),i.invalidateQueries([o.je,e]),i.invalidateQueries([o.sM,e]),await (null===(t=n.onSuccess)||void 0===t?void 0:t.call(n,...a))}})},p=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=(0,s.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/").concat(n),"PUT",{...i,async onSuccess(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];await u.invalidateQueries([o.BB,{orgUUID:e}]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...a))}})}}}]);